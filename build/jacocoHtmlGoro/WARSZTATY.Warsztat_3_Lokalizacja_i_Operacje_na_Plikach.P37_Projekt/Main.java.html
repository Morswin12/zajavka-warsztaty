<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Main.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">WarsztatyZajavka</a> &gt; <a href="index.source.html" class="el_package">WARSZTATY.Warsztat_3_Lokalizacja_i_Operacje_na_Plikach.P37_Projekt</a> &gt; <span class="el_source">Main.java</span></div><h1>Main.java</h1><pre class="source lang-java linenums">package WARSZTATY.Warsztat_3_Lokalizacja_i_Operacje_na_Plikach.P37_Projekt;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.math.BigDecimal;
import java.math.RoundingMode;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.time.LocalDate;
import java.util.*;
import java.util.concurrent.atomic.AtomicInteger;
import java.util.stream.Collectors;
import java.util.stream.Stream;

<span class="nc" id="L17">public class Main {</span>
    public static void main(String[] args) {
<span class="nc" id="L19">        Path path = Paths.get(&quot;src/main/java/WARSZTATY/Warsztat_3_Lokalizacja_i_Operacje_na_Plikach/P37_Projekt/625edfcaf77be5002444b113-client-car-purchase-spreadsheet.csv&quot;);</span>
<span class="nc" id="L20">        List&lt;String&gt; inputList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L21">        List&lt;Purchase&gt; purchases = new ArrayList&lt;&gt;();</span>

        // stworzenie listy StringÃ³w gdzie kaÅ¼da linia jest nowÄ… pozycjÄ…
<span class="nc" id="L24">        readInputFileAndAddContentToLineList(path, inputList);</span>

        // Stworzenie Listy Transakcji z listy StringÃ³w danych wejÅ›ciowych, gdzie kaÅ¼da pozycja jest nowÄ… transakcjÄ…
<span class="nc" id="L27">        inputList.forEach(line -&gt; madePurchesListWithLineList(line, purchases));</span>

        // ZAD 2 zapisz Transakcje do plikw sortujc po marce samochodu:
//        recordToFileRaportDependingOnTheCompany(purchases);

        // wydruk posortowanej listy nazwy Producenta i wielkoci pliku z transakcjami
//        printFileNameAndFileSize();

        // ZADANIE 3
//        createNewFileWithRaport(purchases);

<span class="nc" id="L38">        String model = &quot;TL&quot;;</span>
<span class="nc" id="L39">        checkAmountOfSelledModel(purchases, model);</span>

        // ZADANIE 4

<span class="nc" id="L43">        createNewFileWithRaportForExe4(purchases);</span>
<span class="nc" id="L44">    }</span>

    private static void createNewFileWithRaportForExe4(List&lt;Purchase&gt; purchases) {
<span class="nc" id="L47">        List&lt;String&gt; raport1 = madeRaportDailySellingCars_Exe_4a(purchases);</span>
<span class="nc" id="L48">        List&lt;String&gt; raport2 = madeRaportDailySellingCars_Exe_4b(purchases);</span>

<span class="nc" id="L50">        Path pathOnNewFilesZad4a = Paths.get(&quot;src/main/java/WARSZTATY/Warsztat_3_Lokalizacja_i_Operacje_na_Plikach/P37_Projekt/Zad_4_pliki/RaportOfDailySellingVar1.txt&quot;);</span>
<span class="nc" id="L51">        Path pathOnNewFilesZad4b = Paths.get(&quot;src/main/java/WARSZTATY/Warsztat_3_Lokalizacja_i_Operacje_na_Plikach/P37_Projekt/Zad_4_pliki/RaportOfDailySellingVar2.txt&quot;);</span>
<span class="nc" id="L52">        universalMethodToWriteDataToFileFromList(raport1, pathOnNewFilesZad4a);</span>
<span class="nc" id="L53">        universalMethodToWriteDataToFileFromList(raport2, pathOnNewFilesZad4b);</span>

<span class="nc" id="L55">    }</span>

    private static List&lt;String&gt; madeRaportDailySellingCars_Exe_4b(List&lt;Purchase&gt; purchases) {
<span class="nc" id="L58">        TreeMap&lt;LocalDate, BigDecimal&gt; map = purchases.stream().collect(Collectors.toMap(</span>
                Purchase::getData_zakupu,
<span class="nc" id="L60">                value -&gt; BigDecimal.ONE,</span>
                BigDecimal::add,
                TreeMap::new
        ));
<span class="nc" id="L64">        ArrayList&lt;Map.Entry&lt;LocalDate, BigDecimal&gt;&gt; entryArrayList = new ArrayList&lt;&gt;(map.entrySet());</span>
<span class="nc" id="L65">        entryArrayList.sort(Map.Entry.comparingByValue(Comparator.reverseOrder()));</span>


<span class="nc" id="L68">        return entryArrayList.stream()</span>
<span class="nc" id="L69">                .map(entry -&gt; &quot;W dniu: &quot; + entry.getKey() + &quot; sprzedano: &quot; + entry.getValue() + &quot; aut.&quot; )</span>
<span class="nc" id="L70">                .collect(Collectors.toList());</span>
    }

    private static List&lt;String&gt; madeRaportDailySellingCars_Exe_4a(List&lt;Purchase&gt; purchases) {
<span class="nc" id="L74">        TreeMap&lt;LocalDate, BigDecimal&gt; collect = purchases.stream().collect(Collectors.toMap(</span>
                Purchase::getData_zakupu,
<span class="nc" id="L76">                value -&gt; BigDecimal.ONE,</span>
                BigDecimal::add,
                TreeMap::new
        ));

<span class="nc" id="L81">        return collect.entrySet().stream()</span>
<span class="nc" id="L82">                .map(entry -&gt; &quot;W dniu: &quot; + entry.getKey() + &quot; sprzedano: &quot; + entry.getValue() + &quot; aut.&quot;)</span>
<span class="nc" id="L83">                .collect(Collectors.toList());</span>
    }


    private static void createNewFileWithRaport(List&lt;Purchase&gt; purchases) {
<span class="nc" id="L88">        List&lt;String&gt; raportAboutAveragePriceDependentOnCarsModel = madeRaportAboutAveragePriceDependentOnCarsModel(purchases);</span>

<span class="nc" id="L90">        Path pathOnNewFilesZad3 = Paths.get(&quot;src/main/java/WARSZTATY/Warsztat_3_Lokalizacja_i_Operacje_na_Plikach/P37_Projekt/Zad_3_pliki/RaportOfAveragePrice.txt&quot;);</span>

<span class="nc" id="L92">        universalMethodToWriteDataToFileFromList(raportAboutAveragePriceDependentOnCarsModel, pathOnNewFilesZad3);</span>
<span class="nc" id="L93">    }</span>

    private static List&lt;String&gt; madeRaportAboutAveragePriceDependentOnCarsModel(List&lt;Purchase&gt; purchases) {
<span class="nc" id="L96">        TreeMap&lt;String, List&lt;BigDecimal&gt;&gt; stringListTreeMap = purchases.stream().collect(Collectors.toMap(</span>
<span class="nc" id="L97">                key -&gt; &quot;&quot; + key.getSamochod().getCar_company() + &quot; &quot; + key.getSamochod().getCar_model(),</span>
<span class="nc" id="L98">                value -&gt; List.of(value.getSamochod().getPrice(), BigDecimal.ONE),</span>
<span class="nc" id="L99">                (left, right) -&gt; List.of(left.get(0).add(right.get(0)), left.get(1).add(BigDecimal.ONE)),</span>
                TreeMap::new
        ));
<span class="nc" id="L102">        return stringListTreeMap.entrySet().stream()</span>
<span class="nc" id="L103">                .map(entry -&gt; &quot;Samochd: &quot; + entry.getKey() + &quot;, sprzedano: &quot; + entry.getValue().get(1)</span>
<span class="nc" id="L104">                        + &quot; szt., gdzie Å›rednia cena to: &quot; + averagePriceOfModel(entry) + &quot; Euro.&quot;)</span>
<span class="nc" id="L105">                .collect(Collectors.toList());</span>
    }

    private static BigDecimal averagePriceOfModel(Map.Entry&lt;String, List&lt;BigDecimal&gt;&gt; entry) {
<span class="nc" id="L109">        return entry.getValue().get(0).divide(entry.getValue().get(1), 2, RoundingMode.HALF_UP);</span>
    }


    private static void printFileNameAndFileSize() {
<span class="nc" id="L114">        Path pathOnFiles = Paths.get(&quot;src/main/java/WARSZTATY/Warsztat_3_Lokalizacja_i_Operacje_na_Plikach/P37_Projekt/Zad_2_pliki&quot;);</span>
        try {
<span class="nc" id="L116">            Stream&lt;Path&gt; listOfFilesTxt = Files.list(pathOnFiles);</span>
<span class="nc" id="L117">            TreeMap&lt;Long, List&lt;String&gt;&gt; collect = listOfFilesTxt.collect(Collectors.toMap(</span>
                    key1 -&gt; {
<span class="nc" id="L119">                        long size = 0;</span>
                        try {
<span class="nc" id="L121">                            size = Files.size(key1.toAbsolutePath());</span>
<span class="nc" id="L122">                        } catch (IOException e) {</span>
<span class="nc" id="L123">                            e.printStackTrace();</span>
<span class="nc" id="L124">                        }</span>
<span class="nc" id="L125">                        return size;</span>
                    },
<span class="nc" id="L127">                    value -&gt; new ArrayList&lt;&gt;(List.of(value.getFileName().toString().replaceAll(&quot;\\.txt&quot;, &quot;&quot;))),</span>
                    Main::margeObjectToValueInMapIfDuplicate,
                    TreeMap::new
            ));

<span class="nc bnc" id="L132" title="All 2 branches missed.">            for (Map.Entry&lt;Long, List&lt;String&gt;&gt; longListEntry : collect.entrySet()) {</span>
<span class="nc" id="L133">                System.out.println(longListEntry.getKey() + &quot;,  &quot; + longListEntry.getValue());</span>
<span class="nc" id="L134">            }</span>
<span class="nc" id="L135">            System.out.println(collect);</span>

<span class="nc" id="L137">        } catch (IOException e) {</span>
<span class="nc" id="L138">            e.printStackTrace();</span>
<span class="nc" id="L139">        }</span>


<span class="nc" id="L142">    }</span>

    private static void recordToFileRaportDependingOnTheCompany(List&lt;Purchase&gt; purchases) {
<span class="nc" id="L145">        LinkedHashSet&lt;String&gt; collect = purchases.stream()</span>
<span class="nc" id="L146">                .map(p -&gt; p.getSamochod().getCar_company())</span>
<span class="nc" id="L147">                .collect(Collectors.toCollection(LinkedHashSet::new));</span>
//        System.out.println(collect);

<span class="nc" id="L150">        Map&lt;String, List&lt;Purchase&gt;&gt; mapKeyCompanyValuePurchase = purchases.stream()</span>
<span class="nc" id="L151">                .collect(Collectors.toMap(</span>
<span class="nc" id="L152">                        key -&gt; key.getSamochod().getCar_company(),</span>
<span class="nc" id="L153">                        value -&gt; new ArrayList&lt;&gt;(List.of(value)),</span>
                        Main::margeObjectToValueInMapIfDuplicate,
                        HashMap::new));

//        System.out.println(mapKeyCompanyValuePurchase);
<span class="nc bnc" id="L158" title="All 2 branches missed.">        for (Map.Entry&lt;String, List&lt;Purchase&gt;&gt; stringListEntry : mapKeyCompanyValuePurchase.entrySet()) {</span>

<span class="nc" id="L160">            String pathString = &quot;src/main/java/WARSZTATY/Warsztat_3_Lokalizacja_i_Operacje_na_Plikach/P37_Projekt/Zad_2_pliki/&quot;</span>
<span class="nc" id="L161">                    + stringListEntry.getKey() + &quot;.txt&quot;;</span>
<span class="nc" id="L162">            Path path = Paths.get(pathString);</span>

<span class="nc" id="L164">            try (BufferedWriter writer = Files.newBufferedWriter(path)) {</span>
<span class="nc" id="L165">                writer.write(stringListEntry.getValue().toString());</span>
<span class="nc" id="L166">            } catch (IOException e) {</span>
<span class="nc" id="L167">                e.printStackTrace();</span>
<span class="nc" id="L168">            }</span>
<span class="nc" id="L169">        }</span>
<span class="nc" id="L170">    }</span>


    private static &lt;R&gt; List&lt;R&gt; margeObjectToValueInMapIfDuplicate(List&lt;R&gt; left, List&lt;R&gt; right) {
<span class="nc" id="L174">        List&lt;R&gt; result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L175">        result.addAll(left);</span>
<span class="nc" id="L176">        result.addAll(right);</span>
<span class="nc" id="L177">        return result;</span>
    }

    private static void readInputFileAndAddContentToLineList(Path path, List&lt;String&gt; inputList) {
<span class="nc" id="L181">        try (BufferedReader reader = Files.newBufferedReader(path)) {</span>
<span class="nc" id="L182">            String line = reader.readLine();</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">            while ((line = reader.readLine()) != null) {</span>
<span class="nc" id="L184">                inputList.add(line);</span>
            }
<span class="nc" id="L186">        } catch (IOException e) {</span>
<span class="nc" id="L187">            e.printStackTrace();</span>
<span class="nc" id="L188">        }</span>
<span class="nc" id="L189">    }</span>

    private static void madePurchesListWithLineList(String line, List&lt;Purchase&gt; purchaseList) {
<span class="nc" id="L192">        String[] split = line.split(&quot;,&quot;);</span>
<span class="nc" id="L193">        int length = split.length;</span>
<span class="nc" id="L194">        String[] splitDate = split[13].split(&quot;-&quot;);</span>
<span class="nc" id="L195">        List&lt;Integer&gt; collect = Arrays.stream(splitDate).map(Integer::parseInt)</span>
<span class="nc" id="L196">                .toList();</span>
<span class="nc" id="L197">        String[] priceArray = split[10].split(&quot;â‚¬&quot;);</span>
<span class="nc" id="L198">        String[] price = priceArray[1].split(&quot;\&quot;&quot;);</span>
//        System.out.println(&quot;length: &quot; + length);
//        System.out.println(&quot;id: &quot; + split[0] + &quot;, first_name: &quot; + split[1] + &quot;, second_name: &quot; + split[2] + &quot;, email: &quot;
//                + split[3] + &quot;, ip: &quot; + split[4] + &quot;, color: &quot; + split[5] + &quot;, VIN: &quot; + split[6]
//                + &quot;, Company: &quot; + split[7] + &quot;, model: &quot; + split[8] + &quot;, year: &quot; + split[9] + &quot;, price: &quot; + split[10]
//                + &quot;, country: &quot; + split[11] + &quot;, city: &quot; + split[12] + &quot;, date: &quot; + split[13]);
<span class="nc" id="L204">        purchaseList.add(</span>
                new Purchase(
                        new BigDecimal(split[0]),
                        new Osoba(
                                split[1],
                                split[2],
                                split[3],
                                split[4]),
                        new Samochod(
                                split[5],
                                split[6],
                                split[7],
                                split[8],
                                split[9],
                                new BigDecimal(price[0])),
                        new Lokalizacja(
                                split[11],
                                split[12]),
<span class="nc" id="L222">                        LocalDate.of(</span>
<span class="nc" id="L223">                                collect.get(0),</span>
<span class="nc" id="L224">                                collect.get(1),</span>
<span class="nc" id="L225">                                collect.get(2))</span>
                )
        );

<span class="nc" id="L229">    }</span>

    private static void checkAmountOfSelledModel(List&lt;Purchase&gt; purchases, String model) {
<span class="nc" id="L232">        AtomicInteger atomicInteger = new AtomicInteger(0);</span>
<span class="nc" id="L233">        List&lt;BigDecimal&gt; decimalList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L234">        decimalList.add(BigDecimal.ZERO);</span>
<span class="nc" id="L235">        purchases.stream()</span>
<span class="nc" id="L236">                .filter(purchase -&gt; model.equals(purchase.getSamochod().getCar_model()))</span>
<span class="nc" id="L237">                .forEach(purchase -&gt; {</span>
<span class="nc" id="L238">                            atomicInteger.addAndGet(1);</span>
<span class="nc" id="L239">                            decimalList.add(purchase.getSamochod().getPrice());</span>
<span class="nc" id="L240">                            System.out.println(purchase.getSamochod().getPrice());</span>
<span class="nc" id="L241">                        }</span>
                );
<span class="nc" id="L243">        BigDecimal decimal = BigDecimal.ZERO;</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">        for (BigDecimal bigDecimal : decimalList) {</span>
<span class="nc" id="L245">            decimal = decimal.add(bigDecimal);</span>
<span class="nc" id="L246">        }</span>
<span class="nc" id="L247">        BigDecimal averagePrice = decimal.divide(BigDecimal.valueOf(atomicInteger.longValue()), 2, RoundingMode.HALF_UP);</span>
<span class="nc" id="L248">        System.out.println(&quot;Model: \&quot;&quot; + model + &quot;\&quot; zostaÅ‚ sprzedany: &quot; + atomicInteger + &quot; razy, Å›rednia cena to: &quot; + averagePrice);</span>
<span class="nc" id="L249">    }</span>

    private static void universalMethodToWriteDataToFileFromList(List&lt;String&gt; raportAboutAveragePriceDependentOnCarsModel, Path pathOnNewFilesZad4a) {
<span class="nc" id="L252">        try (BufferedWriter writer = Files.newBufferedWriter(pathOnNewFilesZad4a)) {</span>
<span class="nc" id="L253">            int id = 1;</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">            for (String s : raportAboutAveragePriceDependentOnCarsModel) {</span>
<span class="nc" id="L255">                writer.write(id + &quot;. &quot; + s);</span>
<span class="nc" id="L256">                writer.newLine();</span>
<span class="nc" id="L257">                id++;</span>
<span class="nc" id="L258">            }</span>
<span class="nc" id="L259">        } catch (IOException e) {</span>
<span class="nc" id="L260">            e.printStackTrace();</span>
<span class="nc" id="L261">        }</span>
<span class="nc" id="L262">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>